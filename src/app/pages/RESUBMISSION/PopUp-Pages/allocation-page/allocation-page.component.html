<div id="reportPage" class="view-wrapper list-page drilldown mt-0">
  <!-- <div class="paramsDiv"> -->
  <div
    id="reportPageParams"
    class="paramsDiv SearchParams-container"
    [ngClass]="{ 'hide-content': !isContentVisible }"
  >
    <dx-form>
      <dxi-item
        itemType="group"
        cssClass="form-group"
        class="rowGroup"
        [colCount]="8"
        [colCountByScreen]="{ xs: 8, sm: 8, md: 8, lg: 8 }"
      >
        <dxi-item [colSpan]="6">
          <dx-drop-down-box
            labelMode="floating"
            labelLocation="left"
            label="Facility value"
            [(value)]="Facility_Value"
            valueExpr="ID"
            [displayExpr]="facilityDisplayExpr"
            [showClearButton]="false"
            [dataSource]="Facility_DataSource"
          >
            <div *dxTemplate="let data of 'content'">
              <dx-data-grid
                [dataSource]="Facility_DataSource"
                [columns]="[
                  { dataField: 'FacilityLicense', caption: 'License' },
                  { dataField: 'FacilityName', caption: 'Name' },
                  { dataField: 'Region', caption: 'Region' },
                  { dataField: 'Emirate', caption: 'Emirates' },
                  { dataField: 'Zone', caption: 'Zone' },
                  { dataField: 'Type', caption: 'Type' },
                  { dataField: 'Category', caption: 'Category' },
                  { dataField: 'Postoffice', caption: 'Post office' }
                ]"
                [selection]="{ mode: 'multiple' }"
                [hoverStateEnabled]="true"
                [paging]="{ enabled: true, pageSize: 10 }"
                [filterRow]="{ visible: true }"
                [headerFilter]="{ visible: true }"
                [scrolling]="{ mode: 'virtual' }"
                [height]="250"
                [(selectedRowKeys)]="Facility_Value"
              >
              </dx-data-grid>
            </div>
          </dx-drop-down-box>
        </dxi-item>

        <dxi-item [colSpan]="2">
          <div>
            <dx-select-box
              labelMode="floating"
              labelLocation="left"
              label="encounter type"
              [dataSource]="EncounterType_DataSource"
              displayExpr="Name"
              valueExpr="ID"
              [(value)]="EncounterType_Value"
              [searchEnabled]="true"
              (valueChanged)="onDropdownValueChanged()"
              [showClearButton]="false"
            >
            </dx-select-box>
          </div>
        </dxi-item>
      </dxi-item>

      <dxi-item
        itemType="group"
        cssClass="form-group"
        [colCount]="8"
        [colCountByScreen]="{ xs: 8, sm: 8, md: 8, lg: 8 }"
      >
        <dxi-item [colSpan]="2">
          <div>
            <dx-select-box
              labelMode="floating"
              labelLocation="left"
              label="searchOn value"
              [dataSource]="SearchOn_DataSource"
              displayExpr="Name"
              valueExpr="ID"
              [(value)]="SearchOn_Value"
              [searchEnabled]="true"
              (valueChanged)="onDropdownValueChanged()"
              [dropDownOptions]="{ width: 'auto' }"
              [showClearButton]="false"
            >
            </dx-select-box>
          </div>
        </dxi-item>

        <dxi-item [colSpan]="1">
          <dx-select-box
            labelMode="floating"
            labelLocation="left"
            label="Year"
            [(value)]="selectedYear"
            [dataSource]="years"
            (onValueChanged)="onYearChanged($event)"
            placeholder="Year"
            [width]="'auto'"
          ></dx-select-box>
        </dxi-item>

        <dxi-item [colSpan]="1">
          <div>
            <dx-select-box
              labelMode="floating"
              labelLocation="left"
              label="month"
              [dataSource]="monthDataSource"
              displayExpr="name"
              valueExpr="value"
              [(value)]="selectedmonth"
              (onValueChanged)="onMonthValueChanged($event)"
              [dropDownOptions]="{ width: 'auto' }"
            >
            </dx-select-box>
          </div>
        </dxi-item>

        <dxi-item [colSpan]="1">
          <dx-date-box
            labelMode="floating"
            labelLocation="left"
            label="From Date"
            type="date"
            displayFormat="dd/MM/yyyy"
            valueFormat="yyyy/MM/dd"
            [(value)]="From_Date_Value"
            [min]="minDate"
            [max]="maxDate"
          >
          </dx-date-box>
        </dxi-item>

        <dxi-item [colSpan]="1">
          <dx-date-box
            labelMode="floating"
            labelLocation="left"
            label="To Date"
            type="date"
            displayFormat="dd/MM/yyyy"
            valueFormat="yyyy/MM/dd"
            [(value)]="To_Date_Value"
            [min]="minDate"
            [max]="maxDate"
          >
          </dx-date-box>
        </dxi-item>

        <dxi-item [colSpan]="2">
          <dx-check-box
            [value]="LastRemittanceOnly_Value"
            [iconSize]="20"
            text="Latest Remittance Only"
          ></dx-check-box>
        </dxi-item>
      </dxi-item>

      <dxi-item
        itemType="group"
        cssClass="form-group"
        [colCount]="8"
        [colCountByScreen]="{ xs: 8, sm: 8, md: 8, lg: 8 }"
      >
        <dxi-item [colSpan]="2">
          <dx-drop-down-box
            labelMode="floating"
            labelLocation="left"
            label="Payer ID"
            [(value)]="PayerID_Value"
            valueExpr="ID"
            displayExpr="Name"
            [showClearButton]="false"
            [dataSource]="PayerID_DataSource"
          >
            <div *dxTemplate="let data of 'content'">
              <dx-data-grid
                [dataSource]="PayerID_DataSource"
                [columns]="[{ dataField: 'Name', caption: 'Name' }]"
                [selection]="{ mode: 'multiple' }"
                [hoverStateEnabled]="true"
                [paging]="{ enabled: true, pageSize: 10 }"
                [filterRow]="{ visible: true }"
                [headerFilter]="{ visible: true }"
                [scrolling]="{ mode: 'virtual' }"
                [height]="'50vh'"
                [(selectedRowKeys)]="PayerID_Value"
              >
              </dx-data-grid>
            </div>
          </dx-drop-down-box>
        </dxi-item>

        <dxi-item [colSpan]="2">
          <dx-drop-down-box
            labelMode="floating"
            labelLocation="left"
            label="Reciever"
            [(value)]="ReceiverID_Value"
            valueExpr="ID"
            displayExpr="Name"
            [showClearButton]="false"
            [dataSource]="RecieverID_DataSource"
          >
            <div *dxTemplate="let data of 'content'">
              <dx-data-grid
                [dataSource]="RecieverID_DataSource"
                [columns]="[{ dataField: 'Name', caption: 'ID - Name' }]"
                [selection]="{ mode: 'multiple' }"
                [hoverStateEnabled]="true"
                [paging]="{ enabled: true, pageSize: 10 }"
                [filterRow]="{ visible: true }"
                [headerFilter]="{ visible: true }"
                [scrolling]="{ mode: 'virtual' }"
                [height]="'50vh'"
                [(selectedRowKeys)]="ReceiverID_Value"
              >
              </dx-data-grid>
            </div>
          </dx-drop-down-box>
        </dxi-item>

        <dxi-item [colSpan]="3">
          <dx-drop-down-box
            labelMode="floating"
            labelLocation="left"
            label="Denial Code"
            [(value)]="DenialCodes_Value"
            valueExpr="ID"
            displayExpr="Code"
            [showClearButton]="false"
            [dataSource]="DenialCodes_DataSource"
          >
            <div *dxTemplate="let data of 'content'">
              <dx-data-grid
                [dataSource]="DenialCodes_DataSource"
                [columns]="[
                  { dataField: 'Code', caption: 'Code' },
                  { dataField: 'Category', caption: 'Category' },
                  { dataField: 'Name', caption: 'Name' },
                  { dataField: 'Type', caption: 'Type' }
                ]"
                [selection]="{ mode: 'multiple' }"
                [hoverStateEnabled]="true"
                [paging]="{ enabled: true, pageSize: 10 }"
                [filterRow]="{ visible: true }"
                [headerFilter]="{ visible: true }"
                [scrolling]="{ mode: 'virtual' }"
                [height]="'50vh'"
                [(selectedRowKeys)]="DenialCodes_Value"
              >
              </dx-data-grid>
            </div>
          </dx-drop-down-box>
        </dxi-item>

        <dxi-item [colSpan]="1">
          <dx-select-box
            labelMode="floating"
            labelLocation="left"
            label="Fully Rejected"
            [dataSource]="FullyRejected_DataSource"
            displayExpr="value"
            valueExpr="ID"
            placeholder=" "
            [(value)]="FullyRejected_Value"
            [searchEnabled]="true"
            [showClearButton]="false"
            (valueChanged)="onDropdownValueChanged()"
            [dropDownOptions]="{ width: 'auto' }"
          >
          </dx-select-box>
        </dxi-item>
      </dxi-item>

      <dxi-item
        itemType="group"
        cssClass="form-group"
        [colCount]="10"
        [colCountByScreen]="{ xs: 10, sm: 10, md: 10, lg: 10 }"
      >
        <dxi-item [colSpan]="2">
          <dx-select-box
            labelLocation="left"
            label="Resubmission"
            labelMode="floating"
            [dataSource]="ResubmissionType_DataSource"
            displayExpr="Level"
            valueExpr="ID"
            placeholder=" "
            [(value)]="Resubmission_Value"
            [searchEnabled]="true"
            [showClearButton]="false"
            (valueChanged)="onDropdownValueChanged()"
          >
          </dx-select-box>
        </dxi-item>

        <dxi-item [colSpan]="1">
          <dx-select-box
            labelMode="floating"
            labelLocation="left"
            label="Denial Symbol"
            hint="Denial Symbol"
            [dataSource]="[
              { Name: '>', ID: '>' },
              { Name: '<', ID: '<' }
            ]"
            displayExpr="Name"
            valueExpr="ID"
            [(value)]="Denial_Amount_Symbol"
            [searchEnabled]="false"
            [showClearButton]="false"
          ></dx-select-box>
        </dxi-item>

        <dxi-item [colSpan]="2">
          <dx-number-box
            labelMode="floating"
            labelLocation="left"
            label="Denial Amount"
            hint="Denial Amount"
            [(value)]="Denial_Amount"
            placeholder="Amount"
            [min]="0"
            format="#0"
          ></dx-number-box>
        </dxi-item>

        <dxi-item [colSpan]="1">
          <dx-select-box
            labelMode="floating"
            labelLocation="left"
            label="Ageing Symbol"
            hint="Ageing Symbol"
            [dataSource]="[
              { Name: '>', ID: '>' },
              { Name: '<', ID: '<' }
            ]"
            displayExpr="Name"
            valueExpr="ID"
            placeholder=" "
            [(value)]="Ageing_Symbol"
            [searchEnabled]="true"
            [showClearButton]="false"
            (valueChanged)="onDropdownValueChanged()"
          ></dx-select-box>
        </dxi-item>

        <dxi-item [colSpan]="2">
          <dx-number-box
            labelMode="floating"
            labelLocation="left"
            label="Ageing Days"
            hint="Ageing Days"
            [(value)]="Ageing_Days"
            placeholder="Days"
            [min]="0"
            format="#0"
          ></dx-number-box>
        </dxi-item>

        <dxi-item [colSpan]="1" class="ms-auto mt-1">
          <dx-button
            class="ms-1 mt-1"
            icon="clear"
            text="clear"
            type="danger"
            stylingMode="contained"
            (onClick)="clear_all_data()"
          >
          </dx-button>
        </dxi-item>

        <dxi-item [colSpan]="1" class="ms-auto mt-1">
          <dx-button
            class="add-card"
            icon="refresh"
            text="apply"
            type="default"
            stylingMode="contained"
            (onClick)="get_Datagrid_DataSource()"
          >
          </dx-button>
        </dxi-item>
      </dxi-item>
      <input
        #fileInput
        type="file"
        accept=".xlsx, .xls"
        hidden
        (change)="import_template_data($event)"
      />
    </dx-form>
  </div>
  <div class="button-container mt-1 mb-2">
    <dx-button
      class="toggleButton"
      icon="{{ isContentVisible ? 'chevronup' : 'chevrondown' }}"
      stylingMode="outlined"
      type="normal"
      [hint]="isContentVisible ? 'Hide Filter Contend' : 'Show Filter Contend'"
      [width]="200"
      [height]="13"
      (onClick)="toggleContent()"
    >
    </dx-button>
  </div>
  <!-- ====================================Data GRid Table started================================ -->
  <ng-container>
    <div class="d-flex">
      <dx-tabs
        class="tabsDiv mb-0"
        keyExpr="id"
        [selectedIndex]="selectedIndex"
        [rtlEnabled]="rtlEnabled"
        [scrollByContent]="scrollByContent"
        [showNavButtons]="showNavButtons"
        [dataSource]="tabsWithText"
        orientation="horizontal"
        [stylingMode]="stylingMode"
        [iconPosition]="iconPosition"
        (onItemClick)="onTabChange($event.itemData.id)"
      ></dx-tabs>
      <div
        class="d-flex justify-content-center align-items-center m-0 p-0 gap-2"
      >
        <dx-button
          class="add-card ms-3"
          icon="import"
          text=""
          type="success"
          hint="export excel template"
          stylingMode="contained"
          (onClick)="download_template_columns()"
        >
        </dx-button>
        <dx-button
          class="add-card"
          icon="arrowdown"
          text=""
          type="default"
          hint="import excel data"
          stylingMode="contained"
          (onClick)="fileInput.click()"
        >
        </dx-button>
      </div>
    </div>

    <div class="allocation m-0 p-0">
      <dx-tree-list
        [visible]="selectedTabId === 1"
        class="grid theme-dependent"
        noDataText="No data available"
        [dataSource]="MainTreeDataSource"
        itemsExpr="items"
        [columns]="columns"
        dataStructure="tree"
        [showBorders]="true"
        [showRowLines]="true"
        [allowColumnResizing]="true"
        [allowColumnReordering]="true"
        [rowAlternationEnabled]="true"
        rowAlternationInterval="2"
        [height]="'75vh'"
        [columnAutoWidth]="true"
        [autoExpandAll]="false"
        (onSelectionChanged)="onSelectionChanged($event)"
      >
        <dxo-pager
          [visible]="true"
          [allowedPageSizes]="allowedPageSizes"
          [displayMode]="displayMode"
          [showPageSizeSelector]="showPageSizeSelector"
          [showInfo]="true"
          [showNavigationButtons]="true"
        ></dxo-pager>
        <dxo-selection mode="multiple" [recursive]="true"> </dxo-selection>
        <dxo-paging [pageSize]="10"></dxo-paging>
        <dxo-load-panel [showPane]="false"></dxo-load-panel>
        <dxo-scrolling mode="virtual"></dxo-scrolling>
        <dxo-sorting mode="multiple"></dxo-sorting>
        <dxo-header-filter [visible]="true">
          <dxo-search [enabled]="true"></dxo-search>
        </dxo-header-filter>
        <dxo-filter-row [visible]="true"></dxo-filter-row>
        <dxo-toolbar>
          <!-- <dxi-item location="before">
            <div class="grid-header">Resubmission Allocation</div>
          </dxi-item> -->

          <dxi-item location="after" locateInMenu="auto" class="ms-1">
            <div class="d-flex gap-1 ms-auto">
              <dx-select-box
                labelMode="floating"
                labelLocation="left"
                label="Allocate to User"
                [(value)]="treeview_Allocate_User"
                [items]="userDataSorce"
                displayExpr="DESCRIPTION"
                valueExpr="ID"
                [searchEnabled]="true"
              >
              </dx-select-box>
              <dx-text-box
                labelMode="floating"
                labelLocation="left"
                label="Remarks"
                [(value)]="TreeViewRemarks"
                [width]="450"
              >
              </dx-text-box>
            </div>
          </dxi-item>

          <dxi-item location="after" locateInMenu="auto" class="me-1">
            <div>
              <dx-number-box
                labelMode="floating"
                labelLocation="left"
                label="Claim Count"
                [(value)]="TreeViewselectedChildRowsCount"
                [readOnly]="true"
                [width]="150"
              >
              </dx-number-box>
            </div>
          </dxi-item>

          <dxi-item location="after" locateInMenu="auto">
            <dx-button
              class="add-card"
              icon="save"
              text="Save"
              type="default"
              stylingMode="contained"
              (onClick)="save_data_From_TreeView()"
            >
            </dx-button>
          </dxi-item>
        </dxo-toolbar>
      </dx-tree-list>
    </div>

    <div class="allocation">
      <dx-data-grid
        [visible]="selectedTabId === 2"
        class="grid theme-dependent"
        noDataText="No data available"
        [dataSource]="gridDataSource"
        [columns]="columns"
        [showBorders]="true"
        [showRowLines]="true"
        [allowColumnResizing]="true"
        [allowColumnReordering]="true"
        [rowAlternationEnabled]="true"
        [height]="'75vh'"
        [columnAutoWidth]="true"
        (onSelectionChanged)="gridData_onSelectionChanged($event)"
      >
        <!-- Pagination -->
        <dxo-scrolling rowRenderingMode="stantard"></dxo-scrolling>
        <dxo-pager
          [visible]="true"
          [allowedPageSizes]="allowedPageSizes"
          [displayMode]="displayMode"
          [showPageSizeSelector]="showPageSizeSelector"
          [showInfo]="true"
          [showNavigationButtons]="true"
        ></dxo-pager>
        <dxo-paging [pageSize]="10"></dxo-paging>

        <!-- Selection -->
        <dxo-selection mode="multiple"></dxo-selection>

        <!-- Sorting & Filtering -->
        <dxo-sorting mode="multiple"></dxo-sorting>
        <dxo-header-filter [visible]="true">
          <dxo-search [enabled]="true"></dxo-search>
        </dxo-header-filter>
        <dxo-filter-row [visible]="true"></dxo-filter-row>
        <!-- Scrolling Mode -->
        <dxo-scrolling mode="virtual"></dxo-scrolling>
        <!-- Load Panel -->
        <dxo-load-panel [showPane]="false"></dxo-load-panel>
        <!-- Toolbar -->
        <dxo-toolbar>
          <!-- <dxi-item location="before">
            <div class="grid-header">Resubmission Allocation</div>
          </dxi-item> -->

          <dxi-item location="after" locateInMenu="auto" class="ms-1">
            <div class="d-flex gap-1">
              <dx-select-box
                labelMode="floating"
                labelLocation="left"
                label="Allocate to User"
                [(value)]="datagrid_allocated_User"
                [items]="userDataSorce"
                displayExpr="DESCRIPTION"
                valueExpr="ID"
                [searchEnabled]="true"
              >
              </dx-select-box>
              <dx-text-box
                labelMode="floating"
                labelLocation="left"
                label="Remarks"
                [(value)]="datagridRemarks"
                [width]="450"
              >
              </dx-text-box>
            </div>
          </dxi-item>

          <dxi-item location="after" locateInMenu="auto" class="me-1">
            <dx-text-box
              labelMode="floating"
              labelLocation="left"
              label="Claim Count"
              [(value)]="dataGridselectedChildRowsCount"
              [readOnly]="true"
              [width]="150"
            >
            </dx-text-box>
          </dxi-item>

          <dxi-item location="after" locateInMenu="auto">
            <dx-button
              class="add-card"
              icon="save"
              text="Save"
              type="default"
              stylingMode="contained"
              (onClick)="save_data_From_GridView()"
            >
            </dx-button>
          </dxi-item>
        </dxo-toolbar>
      </dx-data-grid>
    </div>
  </ng-container>
</div>

<!-- excel data import Popup Component -->
<!-- <dx-popup
  [(visible)]="excel_popupVisible"
  [width]="800"
  [height]="500"
  [showTitle]="true"
  title="Import Excel Data"
  [dragEnabled]="true"
  [closeOnOutsideClick]="false"
>
  <div *dxTemplate="let data of 'content'">

    <dx-data-grid
      #dataGrid1
      [dataSource]="Import_Excel_gridData"
      [columns]="excel_import_Columns"
      [showBorders]="true"
      [height]="'100%'"
      [pager]="{
        allowedPageSizes: [5, 10, 20],
        showPageSizeSelector: true,
        showInfo: true,
        showNavigationButtons: true
      }"
    >
      <dxo-paging [pageSize]="5"></dxo-paging>
      <dxo-scrolling mode="virtual"></dxo-scrolling>
      <dxo-toolbar>
        <dxi-item location="after" locateInMenu="auto" class="me-2 ms-2">
          <dx-button
            text=""
            icon="arrowdown"
            type="default"
            stylingMode="contained"
            class="add-button"
            hint="Import Data"
            (onClick)="fileInput.click()"
          ></dx-button>
        </dxi-item>

        <dxi-item location="after" locateInMenu="auto" class="me-2 ms-2">
          <dx-button
            text=""
            icon="import"
            type="success"
            stylingMode="contained"
            class="add-button"
            hint="Download Template"
            (onClick)="download_template_columns()"
          ></dx-button>
        </dxi-item>

        <dxi-item location="after" locateInMenu="auto" class="me-2 ms-2">
          <dx-button
            text="Apply"
            icon=""
            type="default"
            stylingMode="contained"
            class="add-button"
            hint="load Data"
            (onClick)="dataLoading_Uisng_ExcelData()"
          ></dx-button>
        </dxi-item>
      </dxo-toolbar>
      <input
        #fileInput
        type="file"
        accept=".xlsx, .xls"
        hidden
        (change)="import_template_data($event)"
      />
    </dx-data-grid>
  </div>
</dx-popup> -->
<!-- ============== import response list data ============= -->
<dx-popup
  [(visible)]="Error_data_list"
  [width]="800"
  [height]="500"
  [showTitle]="true"
  title="Excel Data Validation"
  [dragEnabled]="true"
  [closeOnOutsideClick]="false"
>
  <div>
    <dx-data-grid
      [dataSource]="Import_Validation_gridData"
      [columns]="[
        { dataField: 'FacilityID', caption: 'Facility ID' },
        { dataField: 'ClaimNumber', caption: 'Claim Number' },
        { dataField: 'Remarks', caption: 'Remarks' },
        { dataField: 'FailureReason', caption: 'Failure Reason' }
      ]"
      [showBorders]="true"
      [height]="'100%'"
      [pager]="{
        allowedPageSizes: [5, 10, 20],
        showPageSizeSelector: true,
        showInfo: true,
        showNavigationButtons: true
      }"
      (onRowPrepared)="setRowColor($event)"
    >
      <dxo-paging [pageSize]="5"></dxo-paging>
      <dxo-scrolling mode="virtual"></dxo-scrolling>
    </dx-data-grid>
  </div>
</dx-popup>

<dx-load-panel
  #loadPanel
  shadingColor="rgba(0,0,0,0.0)"
  [(visible)]="loadingVisible"
  [position]="{ my: 'center', at: 'center', of: '#reportPage' }"
  [showIndicator]="true"
  [showPane]="false"
  [shading]="false"
  [hideOnOutsideClick]="false"
  [message]="'Loading...'"
  [width]="300"
  [height]="150"
>
</dx-load-panel>
